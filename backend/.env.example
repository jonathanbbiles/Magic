APCA_API_KEY_ID=YOUR_ALPACA_KEY_ID
APCA_API_SECRET_KEY=YOUR_ALPACA_SECRET_KEY
# Alternate key envs also supported:
# ALPACA_KEY_ID, ALPACA_API_KEY_ID, ALPACA_API_KEY
# Alternate secret envs also supported:
# ALPACA_SECRET_KEY, ALPACA_API_SECRET_KEY
TRADE_BASE=https://api.alpaca.markets
DATA_BASE=https://data.alpaca.markets
API_TOKEN=CHANGE_ME_TO_A_LONG_RANDOM_STRING
CORS_ALLOWED_ORIGINS=http://localhost:19006,http://localhost:8081
# Device/LAN testing: set CORS_ALLOW_LAN=true to allow exp://, localhost, 10.*, 192.168.*, 172.16-31
CORS_ALLOW_LAN=true
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX=240 # dev; adjust for prod
RECORDER_ENABLED=true
# DATASET_DIR defaults to ./data. On ephemeral hosts, point to a persistent disk mount.
DATASET_DIR=./data
# Alpaca logging: defaults to quiet unless explicitly set to 1.
DEBUG_ALPACA_HTTP=0     # set to 1 to log Alpaca request URLs and allow OK market data logs
DEBUG_ALPACA_HTTP_OK=0  # set to 1 to log OK market data lines without full HTTP debug
# === Exits & Risk ===
EXIT_POLICY_LOCKED=true         # lock exit policy to GTC TP-only flow
EXIT_MODE=net_after_fees        # enforced when EXIT_POLICY_LOCKED=true
EXIT_NET_PROFIT_AFTER_FEES_BPS=5 # target net-after-fees profit (0.05%)
EXIT_FIXED_NET_PROFIT_BPS=5     # fixed net profit target added on top of fees (0.05%)
EXIT_POST_ONLY=true             # use post-only on exit limit sells when supported
EXIT_CANCELS_ENABLED=1          # allow TP/exit sell cancels when policy allows
SELL_REPRICE_ENABLED=1          # enable TP cancel/replace repricing
EXIT_TAKER_ON_TOUCH_ENABLED=false # disable taker-on-touch exits
EXIT_MARKET_EXITS_ENABLED=1     # enable stop-loss/timeout/max-hold market exits
DISABLE_IOC_EXITS=true           # true = use MARKET sell instead of IOC/limit exits (prevents canceled limit sell noise)
EXIT_LIMIT_SELL_TIF=gtc          # used only when DISABLE_IOC_EXITS=false; gtc rests, ioc cancels if not immediately filled
EXIT_ORDER_CLASS=limit          # "limit" => TP-only without OCO stop-loss
STOP_LOSS_BPS=50                # stop loss distance from entry, in basis points (0.50%)
STOP_LIMIT_OFFSET_BPS=10        # stop-limit is an extra 0.10% below the stop price
DESIRED_NET_PROFIT_BASIS_POINTS=100 # target net profit per trade after fees (1.00%); tune so gross stays ~60-150 bps after fees
# Entry-side take-profit target in basis points (gross). If unset, backend defaults to DESIRED_NET_PROFIT_BASIS_POINTS.
TARGET_PROFIT_BPS=100
# EXIT_NET_PROFIT_AFTER_FEES_BPS=5  # only used when EXIT_MODE=net_after_fees
EXIT_SPREAD_AWARE_ENABLED=true      # if true, widen exit target based on live spread
EXIT_SPREAD_BPS_MULTIPLIER=1.0      # multiplier applied to spread bps when adjusting exit target
EXIT_SPREAD_BPS_ADD=0               # additive bps applied after spread multiplier
EXIT_SPREAD_BPS_CAP=250             # cap spread bps input for adjustments
EXIT_SPREAD_BPS_FLOOR=0             # floor spread bps input for adjustments
MAX_GROSS_TAKE_PROFIT_BASIS_POINTS=150 # cap gross take-profit distance above entry (1.50%)
MIN_GROSS_TAKE_PROFIT_BASIS_POINTS=60  # floor gross take-profit distance above entry (0.60%)
# Exits can tolerate older quotes than entries
EXIT_QUOTE_MAX_AGE_MS=120000
# Optional stricter threshold (only used if you set it)
EXIT_STALE_QUOTE_MAX_AGE_MS=15000
EXIT_REPAIR_INTERVAL_MS=60000     # run orphan-exit repair at most once per minute
EXIT_REFRESH_ENABLED=true         # refresh stale exit orders with a fresh limit
EXIT_MAX_ORDER_AGE_MS=120000      # refresh exit orders older than this age
EXIT_REPRICE_THRESHOLD_BPS=25     # cancel/replace when TP deviates beyond this many bps
EXIT_MAX_HOLD_SECONDS=0           # force-exit after N seconds (0 disables)
EXIT_FORCE_EXIT_MODE=ioc_limit    # ioc_limit or market
SELL_QTY_MATCH_EPSILON=1e-9       # qty tolerance when adopting existing TP sells
# Buy notional is pct of portfolio, capped by buying power.
TRADE_PORTFOLIO_PCT=0.10
# Master trading gate and safety cooldowns
TRADING_ENABLED=true
TRADING_BLOCK_COOLDOWN_MS=300000
MIN_POSITION_NOTIONAL_USD=1
# SIMPLE_SCALPER: fast spread-only entry mode (defaults OFF if missing; FULL mode is default)
SIMPLE_SCALPER=0
# Optional override for entry scan universe (comma-separated, Alpaca format)
AUTO_SCAN_SYMBOLS=BTC/USD,ETH/USD,SOL/USD,XRP/USD,LINK/USD,AVAX/USD
# Simple scalper spread gate (bps; defaults to MAX_SPREAD_BPS_TO_TRADE if set, otherwise 60)
MAX_SPREAD_BPS_SIMPLE=15
# Max number of concurrent held positions allowed (0 or negative disables the cap)
MAX_CONCURRENT_POSITIONS=0
# Simple scalper TP target: net profit + fee estimate
PROFIT_NET_BPS=100
FEE_BPS_EST=25
# Optional reserve to hold back from buying power
BUYING_POWER_RESERVE_USD=0
# MIN_ORDER_NOTIONAL_USD is your bot's local gate (not Alpaca fees).
MIN_ORDER_NOTIONAL_USD=1        # minimum order size in USD
POST_ONLY_BUY=true              # if true, maker-friendly limit buys use post-only for crypto
POST_ONLY_SELL=false            # NOTE: TP/exit sells ignore this to avoid post-only cancellations (kept for legacy configs)
REPRICE_EVERY_SECONDS=5         # exit manager inspection cadence
SELL_ORDER_TTL_MS=15000         # how long before we replace/repost a TP
MIN_REPRICE_INTERVAL_MS=15000   # minimum time between TP cancel/replace attempts
REPRICE_IF_AWAY_BPS=6           # reprice when current TP is this far away in bps
TAKER_EXIT_ON_TOUCH=false       # legacy env toggle (overridden by EXIT_TAKER_ON_TOUCH_ENABLED)
TAKER_TOUCH_MIN_INTERVAL_MS=5000 # min interval between taker-on-touch exits per symbol
ALLOW_TAKER_BEFORE_TARGET=1      # allow taker exits at breakeven before TP is reached
ENTRY_FILL_TIMEOUT_SECONDS=30    # seconds to wait for maker entry fill before cancel
ENTRY_INTENT_TTL_MS=45000        # cancel/replace entry intent orders older than this
ENTRY_FALLBACK_MARKET=false      # fallback to market entry if maker entry doesn't fill
MAX_HOLD_SECONDS=300             # soft max hold time before exiting if profitable
# Safety: only cancel all orders if you really mean to.
EXIT_CANCELS_FORCE_ALL=0
# FORCE_EXIT_SECONDS=0           # absolute max hold time before forced exit (disabled by default)
FORCE_EXIT_ALLOW_LOSS=false      # dangerous: only enable if you want forced exits at a loss
MAX_SPREAD_BPS_TO_TRADE=25       # skip entries if spread is wider than this
PUP_MIN=0.65                     # minimum pUp probability gate
EV_MIN_BPS=5                     # expected value must be >= this many bps
MIN_EXPECTED_VALUE_BPS=5         # minimum expected value to allow entry (in bps). 5 = 0.05%
EV_BUFFER_BPS=0                  # optional extra safety margin in bps on top of MIN_EXPECTED_VALUE_BPS
MAX_REQUIRED_GROSS_EXIT_BPS=160  # skip if required gross TP bps for +1% net is too high
ENTRY_QUOTE_MAX_AGE_MS=60000     # max age for entry-side quotes (ms)
# ORDERBOOK_GUARD: improve entry decisions using depth/impact
ORDERBOOK_GUARD_ENABLED=true
ORDERBOOK_MAX_AGE_MS=3000
ORDERBOOK_BAND_BPS=10
ORDERBOOK_MIN_DEPTH_USD=250
ORDERBOOK_IMPACT_NOTIONAL_USD=100
ORDERBOOK_MAX_IMPACT_BPS=6
ORDERBOOK_IMBALANCE_BIAS_SCALE=0.04
HALT_ON_ORPHANS=false            # do not halt trading due to orphan detection

# Alpaca market-data throttling (helps avoid HTTP 429 on bars)
BARS_MAX_CONCURRENT=2
BARS_MIN_TIME_MS=300
ENTRY_PREFETCH_CHUNK_SIZE=80

# --- Entry tuning ---
# Predictor threshold. Your model outputs ~0.53 frequently; 0.55 starves entries.
MIN_PROB_TO_ENTER=0.53
# Predictor gating:
# TP-aligned move target in bps (this is what you actually take profit on; e.g. 60-90)
ENTRY_TAKE_PROFIT_BPS=70

# Stretch confidence move target in bps (this is what you "want to see" for confidence; e.g. 100-150)
ENTRY_STRETCH_MOVE_BPS=100

# Entry gate uses TP probability threshold
MIN_PROB_TO_ENTER_TP=0.53

# Optional second confidence filter; 0 disables it
MIN_PROB_TO_ENTER_STRETCH=0

# Entry-side gross take-profit target (bps). Defaults to DESIRED_NET_PROFIT_BASIS_POINTS if unset.
TARGET_PROFIT_BPS=100

# Stop-loss (bps). If unset, backend scales from TARGET_PROFIT_BPS; override here if desired.
STOP_LOSS_BPS=50

# Entry buffer (bps) added into spread gate only (small sanity margin)
ENTRY_BUFFER_BPS=10

# EV guard (corrected to maker-first fees via feeBpsRoundTrip()).
EV_GUARD_ENABLED=true
EV_MIN_BPS=5
EV_BUFFER_BPS=0

# Fees (bps). feeBpsRoundTrip() = maker + (taker_on_touch ? taker : maker)
FEE_BPS_MAKER=10
FEE_BPS_TAKER=20

# Optional slippage (bps) added to EV cost model
SLIPPAGE_BPS=0

# --- Signal enhancers (no new data vendors) ---
# 1) Time-of-day conditioning (neutral unless enabled)
TIME_OF_DAY_ENABLED=0
# JSON map of hour (0-23) to multiplier (1.0 = neutral). Example: {"0":0.95,"9":1.05}
TIME_OF_DAY_PROFILE_JSON=
# Max +/- adjustment to minProbToEnter based on multiplier
TIME_OF_DAY_PROB_ADJ_MAX=0.03
# Max +/- adjustment to minExpectedValueBps based on multiplier
TIME_OF_DAY_EV_ADJ_MAX_BPS=5

# 2) Spread elasticity / liquidity regime filter
SPREAD_ELASTICITY_ENABLED=1
SPREAD_ELASTICITY_WINDOW_MS=300000
SPREAD_ELASTICITY_MAX_RATIO=1.8
SPREAD_ELASTICITY_MIN_BASELINE_BPS=5

# 3) Volatility compression filter
VOL_COMPRESSION_ENABLED=1
VOL_COMPRESSION_LOOKBACK_SHORT=20
VOL_COMPRESSION_LOOKBACK_LONG=60
VOL_COMPRESSION_MIN_RATIO=0.55
VOL_COMPRESSION_MIN_LONG_VOL_BPS=12

# 4) Orderbook imbalance + absorption filter
ORDERBOOK_ABSORPTION_ENABLED=1
ORDERBOOK_ABSORPTION_WINDOW_MS=120000
ORDERBOOK_ABSORPTION_MIN_SAMPLES=3
ORDERBOOK_ABSORPTION_MIN_IMBALANCE_DELTA=0.15
ORDERBOOK_ABSORPTION_MIN_BID_REPLENISH_USD=200
